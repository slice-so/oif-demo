// SPDX-License-Identifier: CC0
pragma solidity 0.8.30;

import {Test} from "forge-std/Test.sol";
import {SetupTest} from "./setup.t.sol";
import {console} from "forge-std/console.sol";
import {OrderResolverCompact} from "../src/OrderResolverCompact.sol";
import {StandardOrder} from "../src/types/StandardOrder.sol";
import {ResolvedOrder} from "../src/types/ResolvedOrder.sol";
import {OrderResolverCompactPayload} from "../src/types/OrderResolverCompactPayload.sol";
import {MandateOutput} from "../src/libraries/MandateOutputType.sol";

contract OutputCallbackTest is SetupTest {
    OutputCallbackMockTest mock = new OutputCallbackMockTest();

    function test_CallbackDestructuring() public view {
        bytes memory dummyCallbackData =
            hex"b9d5B99d5D0fA04dD7eb2b0CD7753317C2ea1a844d5d7d63989bbe6358a3352a2449d59aa5a08267062b8b15000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000004d5d7d63989bbe6358a3352a2449d59aa5a082670000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c0b782920b2de8b55f08fc98004eb5c7d4fbf287000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

        mock.checkOutputCalldataFormatting(dummyCallbackData);
    }
}

contract OutputCallbackMockTest is Test {
    function checkOutputCalldataFormatting(bytes calldata callbackData) public pure {
        // extract address from the FIRST 20 bytes of callbackData
        address target = address(bytes20(callbackData[0:20]));
        // extract address from the NEXT 20 bytes of callbackData
        address payer = address(bytes20(callbackData[20:40]));
        // extract the rest of the callbackData
        bytes memory data = callbackData[40:];

        assertEq(target, address(0xb9d5B99d5D0fA04dD7eb2b0CD7753317C2ea1a84));
        assertEq(payer, address(0x4D5d7d63989BBE6358a3352A2449d59Aa5A08267));
        assertEq(
            data,
            hex"062b8b15000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000004d5d7d63989bbe6358a3352a2449d59aa5a082670000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c0b782920b2de8b55f08fc98004eb5c7d4fbf287000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
        );
    }
}
